{"version":3,"sources":["../src/inkdrop-toc.js"],"names":["TocPlugin","constructor","MDEPreview","start","remarkPlugins","push","Toc","setTocComponent","stop","filter","plugin","unsetTocComponent","OrigA","remarkReactOptions","remarkReactComponents","a","props","hash","href","startsWith","onTocEntryClick","children","duration","entry","substr","length","offset","mdePreview","animate","scrollTop","first","top","module","exports","toc","activate","inkdrop","components","classes","deactivate"],"mappings":";;;AAEA;;;AAFA;;;;AACA;;;;AAEA;;;;;;AAEA,MAAMA,SAAN,CAAgB;;AAEdC,cAAYC,UAAZ,EAAwB;AACtB,SAAKA,UAAL,GAAkBA,UAAlB;AACD;;AAEDC,UAAQ;AACN,QAAI,KAAKD,UAAT,EAAqB;AACnB,WAAKA,UAAL,CAAgBE,aAAhB,CAA8BC,IAA9B,CAAmCC,mBAAnC;AACA,WAAKC,eAAL;AACD;AACF;;AAEDC,SAAO;AACL,QAAI,KAAKN,UAAT,EAAqB;AACnB,WAAKA,UAAL,CAAgBE,aAAhB,GAAgC,KAAKF,UAAL,CAAgBE,aAAhB,CAA8BK,MAA9B,CAAsCC,MAAD,IAAYA,WAAWJ,mBAA5D,CAAhC;AACA,WAAKK,iBAAL;AACD;AACF;;AAEDJ,oBAAkB;AAChB;AACA,UAAMK,QAAQ,KAAKV,UAAL,CAAgBW,kBAAhB,CAAmCC,qBAAnC,CAAyDC,CAAvE;AACA;AACA,SAAKb,UAAL,CAAgBW,kBAAhB,CAAmCC,qBAAnC,CAAyDC,CAAzD,GAA8DC,KAAD,IAAW;AACtE,YAAMC,OAAO,GAAb;AACA,UAAID,MAAME,IAAN,IAAcF,MAAME,IAAN,CAAWC,UAAX,CAAsBF,IAAtB,CAAlB,EAA+C;AAC7C,eAAO;AAAA;AAAA,uBAAOD,KAAP,IAAc,SAAS,MAAM,KAAKI,eAAL,CAAqBJ,KAArB,CAA7B;AAA2DA,gBAAMK;AAAjE,SAAP;AACD,OAFD,MAEO,IAAIT,KAAJ,EAAW;AAChB,eAAO;AAAC,eAAD;AAAWI,eAAX;AAAmBA,gBAAMK;AAAzB,SAAP;AACD,OAFM,MAEA;AACL,eAAO;AAAA;AAAOL,eAAP;AAAeA,gBAAMK;AAArB,SAAP;AACD;AACF,KATD;AAUD;;AAEDV,sBAAoB;AAClB;AACA,UAAMC,QAAQ,KAAKV,UAAL,CAAgBW,kBAAhB,CAAmCC,qBAAnC,CAAyDC,CAAvE;AACA;AACA,SAAKb,UAAL,CAAgBW,kBAAhB,CAAmCC,qBAAnC,CAAyDC,CAAzD,GAA8DC,KAAD,IAAW;AACtE,UAAIA,MAAME,IAAN,IAAcF,MAAME,IAAN,CAAWC,UAAX,CAAsBF,IAAtB,CAAlB,EAA+C;AAC7C,YAAIL,KAAJ,EAAW;AACT,iBAAO;AAAC,iBAAD;AAAWI,iBAAX;AAAmBA,kBAAMK;AAAzB,WAAP;AACD,SAFD,MAEO;AACL,iBAAO;AAAA;AAAOL,iBAAP;AAAeA,kBAAMK;AAArB,WAAP;AACD;AACF;AACF,KARD;AASD;;AAED;AACAD,kBAAgBJ,KAAhB,EAAuB;AACrB,UAAMM,WAAW,GAAjB;AACA,UAAMC,QAAS,iBAAgBP,MAAME,IAAN,CAAWM,MAAX,CAAkB,CAAlB,EAAqBR,MAAME,IAAN,CAAWO,MAAhC,CAAwC,EAAvE;AACA,UAAMC,SAAS,GAAf;AACA,UAAMC,aAAa,sBAAE,cAAF,CAAnB;AACA;AACAA,eAAWnB,IAAX,GAAkBoB,OAAlB,CAA0B,EAACC,WAAW,sBAAEN,KAAF,EAASO,KAAT,GAAiBJ,MAAjB,GAA0BK,GAA1B,GAAgCJ,WAAWE,SAAX,EAAhC,GAAyDH,MAArE,EAA1B,EAAwGJ,QAAxG;AACD;;AA3Da;;AA+DhB;AACAU,OAAOC,OAAP,GAAiB;;AAEfC,OAAK,IAFU;;AAIfC,aAAW;AACT;AACA,UAAM,EAACjC,UAAD,KAAekC,QAAQC,UAAR,CAAmBC,OAAxC;AACA,QAAIpC,UAAJ,EAAgB;AACd,WAAKgC,GAAL,GAAW,IAAIlC,SAAJ,CAAcE,UAAd,CAAX;AACA,WAAKgC,GAAL,CAAS/B,KAAT;AACD;AACF,GAXc;;AAafoC,eAAa;AACX;AACA,SAAKL,GAAL,CAAS1B,IAAT;AACA,SAAK0B,GAAL,GAAW,IAAX;AACD;;AAjBc,CAAjB","file":"inkdrop-toc.js","sourcesContent":["import React from 'react'\nimport Toc from 'remark-toc';\n// noinspection ES6CheckImport\nimport $ from 'jquery';\n\nclass TocPlugin {\n\n  constructor(MDEPreview) {\n    this.MDEPreview = MDEPreview;\n  }\n\n  start() {\n    if (this.MDEPreview) {\n      this.MDEPreview.remarkPlugins.push(Toc);\n      this.setTocComponent();\n    }\n  }\n\n  stop() {\n    if (this.MDEPreview) {\n      this.MDEPreview.remarkPlugins = this.MDEPreview.remarkPlugins.filter((plugin) => plugin !== Toc);\n      this.unsetTocComponent();\n    }\n  }\n\n  setTocComponent() {\n    // noinspection JSUnresolvedVariable\n    const OrigA = this.MDEPreview.remarkReactOptions.remarkReactComponents.a;\n    // noinspection JSUnresolvedVariable\n    this.MDEPreview.remarkReactOptions.remarkReactComponents.a = (props) => {\n      const hash = '#';\n      if (props.href && props.href.startsWith(hash)) {\n        return <a {...props} onClick={() => this.onTocEntryClick(props)}>{props.children}</a>\n      } else if (OrigA) {\n        return <OrigA {...props}>{props.children}</OrigA>\n      } else {\n        return <a {...props}>{props.children}</a>\n      }\n    };\n  }\n\n  unsetTocComponent() {\n    // noinspection JSUnresolvedVariable\n    const OrigA = this.MDEPreview.remarkReactOptions.remarkReactComponents.a;\n    // noinspection JSUnresolvedVariable\n    this.MDEPreview.remarkReactOptions.remarkReactComponents.a = (props) => {\n      if (props.href && props.href.startsWith(hash)) {\n        if (OrigA) {\n          return <OrigA {...props}>{props.children}</OrigA>\n        } else {\n          return <a {...props}>{props.children}</a>\n        }\n      }\n    };\n  }\n\n  // noinspection JSMethodCanBeStatic\n  onTocEntryClick(props) {\n    const duration = 200;\n    const entry = `#user-content-${props.href.substr(1, props.href.length)}`;\n    const offset = 300;\n    const mdePreview = $('.mde-preview');\n    // noinspection JSUnresolvedFunction\n    mdePreview.stop().animate({scrollTop: $(entry).first().offset().top + mdePreview.scrollTop() - offset}, duration);\n  }\n\n}\n\n// noinspection JSUnusedGlobalSymbols\nmodule.exports = {\n\n  toc: null,\n\n  activate() {\n    // noinspection JSUnresolvedVariable\n    const {MDEPreview} = inkdrop.components.classes;\n    if (MDEPreview) {\n      this.toc = new TocPlugin(MDEPreview);\n      this.toc.start();\n    }\n  },\n\n  deactivate() {\n    // noinspection JSUnresolvedVariable\n    this.toc.stop();\n    this.toc = null;\n  },\n\n};\n"]}