{"version":3,"sources":["../src/inkdrop-toc.js"],"names":["TocPlugin","constructor","MDEPreview","start","remarkPlugins","push","Toc","setTocComponent","stop","filter","plugin","unsetTocComponent","OrigA","remarkReactOptions","remarkReactComponents","a","hash","props","href","startsWith","onTocEntryClick","children","duration","entry","substr","length","offset","mdePreview","document","getElementsByClassName","animation","clearTimeout","scrollTop","getElementById","element","difference","perTick","setTimeout","module","exports","toc","activate","inkdrop","components","classes","deactivate"],"mappings":"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","file":"inkdrop-toc.js","sourcesContent":["import React from 'react';\nimport Toc from 'remark-toc';\n\nclass TocPlugin {\n\n  constructor(MDEPreview) {\n    this.MDEPreview = MDEPreview;\n  }\n\n  // noinspection JSUnusedGlobalSymbols\n  start() {\n    if (this.MDEPreview) {\n      this.MDEPreview.remarkPlugins.push(Toc);\n      this.setTocComponent();\n    }\n  }\n\n  // noinspection JSUnusedGlobalSymbols\n  stop() {\n    if (this.MDEPreview) {\n      this.MDEPreview.remarkPlugins = this.MDEPreview.remarkPlugins.filter((plugin) => plugin !== Toc);\n      this.unsetTocComponent();\n    }\n  }\n\n  setTocComponent() {\n    // noinspection JSUnresolvedVariable\n    this.OrigA = this.MDEPreview.remarkReactOptions.remarkReactComponents.a;\n    const hash = '#';\n    // noinspection JSUnresolvedVariable\n    this.MDEPreview.remarkReactOptions.remarkReactComponents.a = (props) => {\n      if (props.href && props.href.startsWith(hash)) {\n        return <a {...props} onClick={() => this.onTocEntryClick(props)}>{props.children}</a>;\n      } else if (this.OrigA) {\n        return <OrigA {...props}>{props.children}</OrigA>;\n      } else {\n        return <a {...props}>{props.children}</a>;\n      }\n    };\n  }\n\n  unsetTocComponent() {\n    // noinspection JSUnresolvedVariable\n    this.MDEPreview.remarkReactOptions.remarkReactComponents.a = this.OrigA;\n  }\n\n  // noinspection JSMethodCanBeStatic\n  onTocEntryClick(props) {\n    const duration = 200;\n    const entry = `user-content-${props.href.substr(1, props.href.length)}`;\n    const offset = 300;\n    const mdePreview = document.getElementsByClassName('mde-preview')[0];\n    if (this.animation) {\n      clearTimeout(this.animation);\n      this.animation = null;\n    }\n    this.scrollTop(mdePreview, document.getElementById(entry) + mdePreview.scrollTop - offset, duration);\n  }\n\n  scrollTop(element, offset, duration) {\n    if (duration <= 0) {\n      return;\n    }\n    const difference = offset - element.scrollTop;\n    const perTick = difference / duration * 10;\n    this.animation = setTimeout(() => {\n      element.scrollTop = element.scrollTop + perTick;\n      if (element.scrollTop >= offset) {\n        return;\n      }\n      this.scrollTop(element, offset, duration - 10);\n    }, 10);\n  }\n\n}\n\nmodule.exports = {\n\n  toc: null,\n\n  activate() {\n    // noinspection JSUnresolvedVariable\n    const {MDEPreview} = inkdrop.components.classes; // eslint-disable-line\n    if (MDEPreview) {\n      this.toc = new TocPlugin(MDEPreview);\n      this.toc.start();\n    }\n  },\n\n  deactivate() {\n    // noinspection JSUnresolvedVariable\n    this.toc.stop();\n    this.toc = null;\n  },\n\n};\n"]}